@model IEnumerable<QLBanSach.Models.DonHang>

@{
    ViewData["Title"] = "Quản lý đơn hàng";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<style>
    .status-badge {
        padding: 4px 10px;
        border-radius: 6px;
        font-weight: 600;
        display: inline-block;
    }

    .st-dathang   { background-color: #ffc107; color: #000; }
    .st-danggiao  { background-color: #0d6efd; color: #fff; }
    .st-danhan    { background-color: #28a745; color: #fff; }
    .st-dahuy     { background-color: #dc3545; color: #fff; }

    select.form-select option.st-dathang   { background-color: #ffe8a1; }
    select.form-select option.st-danggiao  { background-color: #cfe2ff; }
    select.form-select option.st-danhan    { background-color: #d4edda; }
    select.form-select option.st-dahuy     { background-color: #f8d7da; }
</style>

<div class="container mt-4">

    <h2 class="fw-bold text-primary mb-4">
        <i class="bi bi-box-seam"></i> Danh sách đơn hàng
    </h2>

    <!-- FORM LỌC -->
    <form asp-action="Index" method="get" class="card p-3 shadow-sm rounded-4 mb-4">

        <div class="row gy-2">

            <div class="col-md-3">
                <label class="fw-semibold mb-1">Mã người dùng</label>
                <input type="text"
                   name="maNguoiDung"
                   class="form-control"
                   placeholder="Nhập mã người dùng"
                   value="@Context.Request.Query["maNguoiDung"]" />
            </div>

            <div class="col-md-3">
                <label class="fw-semibold mb-1">Trạng thái</label>
                <select name="trangThai" class="form-select">
                    <option value="">-- Tất cả --</option>

                    <option value="Đã đặt hàng" selected="@(Context.Request.Query["trangThai"] == "Đã đặt hàng")">
                        Đã đặt hàng
                    </option>

                    <option value="Đang giao hàng" selected="@(Context.Request.Query["trangThai"] == "Đang giao hàng")">
                        Đang giao hàng
                    </option>

                    <option value="Đã nhận hàng" selected="@(Context.Request.Query["trangThai"] == "Đã nhận hàng")">
                        Đã nhận hàng
                    </option>

                    <option value="Đã hủy" selected="@(Context.Request.Query["trangThai"] == "Đã hủy")">
                        Đã hủy
                    </option>
                </select>
            </div>

           <div class="col-md-2">
                <label class="fw-semibold mb-1">Từ ngày</label>
                <input type="date" name="tuNgay"
                       value="@Context.Request.Query["tuNgay"]"
                       class="form-control" />
            </div>

            <div class="col-md-2">
                <label class="fw-semibold mb-1">Đến ngày</label>
                <input type="date" name="denNgay"
                       value="@Context.Request.Query["denNgay"]"
                       class="form-control" />
            </div>

            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-primary fw-semibold flex-grow-1 me-2">
                    <i class="bi bi-funnel"></i> Lọc
                </button>

                <a asp-action="Index" class="btn btn-secondary fw-semibold px-2"
                   style="height: 38px; display: flex; align-items: center;">
                    <i class="bi bi-arrow-counterclockwise"></i>
                </a>
            </div>

        </div>

    </form>

    <div class="card shadow-sm rounded-4 p-3">
        <table class="table table-bordered table-hover text-center align-middle">
            <thead class="bg-primary text-white">
                <tr>
                    <th>Mã đơn</th>
                    <th>Mã người dùng</th>
                    <th>Địa chỉ</th>
                    <th>Ngày đặt</th>
                    <th>Trạng thái</th>
                    <th>Tổng tiền</th>
                    <th style="width:120px;">Thao tác</th>
                </tr>
            </thead>

            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td class="fw-semibold">@item.MaDonHang</td>
                        <td>@item.MaNguoiDung</td>
                        <td>@item.DiaChiNhanHang</td>
                        <td>@item.NgayDat.ToString("dd/MM/yyyy")</td>

                        <td>
                            @if (item.TrangThai == "Đã đặt hàng")
                            {
                                <span class="badge bg-primary">Đã đặt hàng</span>
                            }
                            else if (item.TrangThai == "Đang giao hàng")
                            {
                                <span class="badge bg-warning text-dark">Đang giao hàng</span>
                            }
                            else if (item.TrangThai == "Đã nhận hàng")
                            {
                                <span class="badge bg-success">Đã nhận hàng</span>
                            }
                            else if (item.TrangThai == "Đã hủy")
                            {
                                <span class="badge bg-danger">Đã hủy</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">@item.TrangThai</span>
                            }
                        </td>

                        <td class="fw-bold text-danger">@String.Format("{0:N0} đ", item.TongTien)</td>

                        <td>
                            <a asp-action="Details" asp-route-id="@item.MaDonHang"
                               class="btn btn-sm btn-info text-white fw-bold px-3">
                                <i class="bi bi-eye"></i> Xem
                            </a>
                        </td>
                    </tr>
                }
            </tbody>

        </table>

        <!-- PHÂN TRANG -->
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center mt-3">
                @for (int i = 1; i <= ViewBag.TotalPages; i++)
                {
                    <li class="page-item @(i == ViewBag.Page ? "active" : "")">
                        <a class="page-link"
                           href="@Url.Action("Index", new {
                               page = i,
                               maNguoiDung = Context.Request.Query["maNguoiDung"],
                               trangThai = Context.Request.Query["trangThai"],
                               tuNgay = Context.Request.Query["tuNgay"],
                               denNgay = Context.Request.Query["denNgay"]
                           })">
                            @i
                        </a>
                    </li>
                }
            </ul>
        </nav>

    </div>

</div>
