@model X.PagedList.IPagedList<QLBanSach.Models.Sach>
@using X.PagedList;

@{
    ViewData["Title"] = "Quản lý sách";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<style>
    .page-container {
        background: #f8f9fb;
        padding: 20px;
        border-radius: 10px;
    }

    table img {
        border-radius: 6px;
        box-shadow: 0px 2px 5px rgba(0,0,0,.22);
    }

    .search-card {
        border-radius: 10px;
        background: white;
        padding: 18px;
    }

    .form-label {
        font-size: 14px;
        font-weight: 600;
    }

    th {
        font-size: 14px;
    }

    td {
        vertical-align: middle !important;
    }

    .pagination .page-link {
        border-radius: 6px !important;
    }

    .btn-sm {
        height: 38px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>


<div class="page-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="fw-bold text-primary m-0"><i class="bi bi-journal-bookmark"></i> Danh sách sách</h2>

        <a asp-action="Create"
           class="btn btn-primary fw-semibold d-flex align-items-center px-3">
            <span class="bg-white text-primary rounded-circle d-flex justify-content-center align-items-center"
                  style="width:22px; height:22px;">
                <i class="bi bi-plus-lg"></i>
            </span>
            <span class="ms-2">Thêm sách</span>
        </a>
    </div>
    <form method="get" class="search-card shadow-sm mb-4 p-3 rounded bg-white">

        <h5 class="fw-semibold pb-2 border-bottom mb-3">Bộ lọc tìm kiếm</h5>

        <div class="row g-3">

            <div class="col-md-2">
                <label class="form-label">Mã sách</label>
                <input name="maSach" type="text" placeholder="VD: S001"
                       class="form-control" value="@ViewBag.MaSach" />
            </div>

            <div class="col-md-3">
                <label class="form-label">Tên sách</label>
                <input name="tenSach" type="text" placeholder="Nhập tên sách"
                       class="form-control" value="@ViewBag.TenSach" />
            </div>

            <div class="col-md-2">
                <label class="form-label">Thể loại</label>
                <select name="maTheLoai" class="form-select" asp-items="ViewBag.TheLoaiList">
                    <option value="">Tất cả</option>
                </select>
            </div>

            <div class="col-md-2">
                <label class="form-label">Tình trạng</label>
                <select name="soLuongStatus" class="form-select">
                    <option value="" selected="@(string.IsNullOrEmpty(ViewBag.SoLuongStatus))">Tất cả</option>
                    <option value="con" selected="@(ViewBag.SoLuongStatus == "con")">Còn hàng</option>
                    <option value="het" selected="@(ViewBag.SoLuongStatus == "het")">Hết hàng</option>
                </select>
            </div>

            <div class="col-md-2">
                <label class="form-label">Sắp xếp giá</label>
                <select name="sortOrder" class="form-select" asp-items="ViewBag.SortList"></select>
            </div>

            <div class="col-md-1 d-flex align-items-end">
                <button type="submit"
                        class="btn btn-primary fw-bold w-100 d-flex justify-content-center align-items-center"
                        style="height: 38px;">
                    <i class="bi bi-search"></i>
                </button>
            </div>

        </div>
    </form>


    <!-- BẢNG -->
    <div class="table-responsive">
        <table class="table table-hover table-bordered align-middle shadow-sm" style="background:white;">
            <thead style="background-color:#0d6efd; color:white;" class="text-center">
                <tr>
                    <th>Mã sách</th>
                    <th class="text-start ps-3">Tên sách</th>
                    <th>Giá</th>
                    <th>Số lượng</th>
                    <th>Ảnh</th>
                    <th>Thể loại</th>
                    <th width="200px">Thao tác</th>
                </tr>
            </thead>

            <tbody class="text-center">
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.MaSach</td>
                        <td class="text-start ps-3 fw-semibold">@item.TenSach</td>
                        <td class="text-danger fw-bold">
                            @string.Format("{0:N0} đ", item.Gia)
                        </td>
                        <td>
                            @if (item.SoLuong > 0)
                            {
                                <span class="badge bg-success">@item.SoLuong</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">0</span>
                            }
                        </td>

                        <td>
                            <img src="/Images/@item.Anh"
                                 alt="@item.TenSach"
                                 style="width:70px; height:100px; object-fit:cover;" />
                        </td>

                        <td>@item.MaTheLoai</td>

                        <td class="text-center">
                            <div class="d-flex justify-content-center gap-2">

                                <a class="btn btn-outline-warning btn-sm px-3 py-1 h-100"
                                   asp-action="Edit"
                                   asp-route-id="@item.MaSach">
                                    <i class="bi bi-pencil-square"></i> Sửa
                                </a>

                                <a class="btn btn-outline-info btn-sm px-3 py-1 h-100"
                                   asp-action="Details"
                                   asp-route-id="@item.MaSach">
                                    <i class="bi bi-eye"></i> Xem
                                </a>

                                <a class="btn btn-outline-danger btn-sm px-3 py-1 h-100"
                                   asp-action="Delete"
                                   asp-route-id="@item.MaSach">
                                    <i class="bi bi-trash"></i> Xóa
                                </a>

                            </div>
                        </td>


                    </tr>
                }
            </tbody>
        </table>
    </div>


    <!-- PHÂN TRANG -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">

            @if (Model.HasPreviousPage)
            {
                <li class="page-item">
                    <a class="page-link"
                       href="@Url.Action("Index", new { page = Model.PageNumber - 1, maSach = ViewBag.MaSach, tenSach = ViewBag.TenSach, maTheLoai = ViewBag.MaTheLoai })">
                        « Trước
                    </a>
                </li>
            }
            else
            {
                <li class="page-item disabled"><span class="page-link">« Trước</span></li>
            }

            @for (int i = 1; i <= Model.PageCount; i++)
            {
                if (i == Model.PageNumber)
                {
                    <li class="page-item active">
                        <span class="page-link">@i</span>
                    </li>
                }
                else
                {
                    <li class="page-item">
                        <a class="page-link"
                           href="@Url.Action("Index", new { page = i, maSach = ViewBag.MaSach, tenSach = ViewBag.TenSach, maTheLoai = ViewBag.MaTheLoai })">@i</a>
                    </li>
                }
            }

            @if (Model.HasNextPage)
            {
                <li class="page-item">
                    <a class="page-link"
                       href="@Url.Action("Index", new { page = Model.PageNumber + 1, maSach = ViewBag.MaSach, tenSach = ViewBag.TenSach, maTheLoai = ViewBag.MaTheLoai })">
                        Tiếp »
                    </a>
                </li>
            }
            else
            {
                <li class="page-item disabled"><span class="page-link">Tiếp »</span></li>
            }

        </ul>
    </nav>
</div>
