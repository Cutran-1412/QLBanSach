@model QLBanSach.Models.DonHang
@{
    ViewData["Title"] = "Chi Tiết Đơn Hàng";
}

<h2>Chi Tiết Đơn Hàng: @Model?.MaDonHang</h2>

<div> 
    <p><strong>Địa chỉ nhận hàng:</strong> @Model?.DiaChiNhanHang</p>
    <p><strong>Ngày đặt:</strong> @(Model?.NgayDat.ToString("dd/MM/yyyy"))</p>
    <p><strong>Trạng thái:</strong> @Model?.TrangThai</p>
</div>

<h3>Danh sách sản phẩm:</h3>

@if (Model?.ChiTietDonHangs != null && Model.ChiTietDonHangs.Any())
{
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>#</th>
                <th>Tên sách</th>
                <th>Số lượng</th>
                <th>Đơn giá</th>
                <th>Thành tiền</th>
            </tr>
        </thead>

        <tbody>
            @{
                int stt = 1;
                decimal tongTien = 0;
            }

            @foreach (var ct in Model.ChiTietDonHangs)
            {
                var gia = ct?.Sach?.Gia ?? 0;
                var tenSach = ct?.Sach?.TenSach ?? "Chưa có tên";
                var soLuong = ct?.SoLuong ?? 0;
                var thanhTien = gia * soLuong;

                <tr>
                    <td>@stt</td>
                    <td>@tenSach</td>
                    <td>@soLuong</td>
                    <td>@gia.ToString("N0")</td>
                    <td>@thanhTien.ToString("N0")</td>
                </tr>

                tongTien += thanhTien;
                stt++;
            }
        </tbody>

        <tfoot>
            <tr>
                <th colspan="4" class="text-right">Tổng tiền:</th>
                <th>@tongTien.ToString("N0")</th>
            </tr>
        </tfoot>
    </table>
    <div class="mt-3">
        <a asp-controller="DonHang"
           asp-action="Index"
           asp-route-id="@Context.Session.GetString("UserId")"
           class="btn btn-secondary">
            ← Quay lại danh sách đơn hàng
        </a>
    </div>

}
else
{
    <p>Chưa có sản phẩm trong đơn hàng.</p>
}
